import{S as j,i as G,s as O,e as S,b as g,g as T,t as f,d as D,f as h,h as d,P as z,k as w,l as y,m as k,n as m,K as B,L as F,D as C,F as A,G as M,H as E}from"./index-3657e411.js";import{w as H}from"./paths-267500fe.js";function L(i){let e,t,l,n,s=!i[2]&&I(i);return{c(){e=w("button"),s&&s.c(),this.h()},l(o){e=y(o,"BUTTON",{class:!0});var a=k(e);s&&s.l(a),a.forEach(d),this.h()},h(){m(e,"class","button svelte-1rmphn3"),e.disabled=i[1],B(e,"spinning",i[2])},m(o,a){g(o,e,a),s&&s.m(e,null),t=!0,l||(n=F(e,"click",i[5]),l=!0)},p(o,a){o[2]?s&&(T(),f(s,1,1,()=>{s=null}),D()):s?(s.p(o,a),a&4&&h(s,1)):(s=I(o),s.c(),h(s,1),s.m(e,null)),(!t||a&2)&&(e.disabled=o[1]),(!t||a&4)&&B(e,"spinning",o[2])},i(o){t||(h(s),t=!0)},o(o){f(s),t=!1},d(o){o&&d(e),s&&s.d(),l=!1,n()}}}function U(i){let e,t;const l=i[4].default,n=C(l,i,i[3],null);return{c(){e=w("a"),n&&n.c(),this.h()},l(s){e=y(s,"A",{class:!0,href:!0,role:!0});var o=k(e);n&&n.l(o),o.forEach(d),this.h()},h(){m(e,"class","button svelte-1rmphn3"),m(e,"href",i[0]),m(e,"role","button")},m(s,o){g(s,e,o),n&&n.m(e,null),t=!0},p(s,o){n&&n.p&&(!t||o&8)&&A(n,l,s,s[3],t?E(l,s[3],o,null):M(s[3]),null),(!t||o&1)&&m(e,"href",s[0])},i(s){t||(h(n,s),t=!0)},o(s){f(n,s),t=!1},d(s){s&&d(e),n&&n.d(s)}}}function I(i){let e;const t=i[4].default,l=C(t,i,i[3],null);return{c(){l&&l.c()},l(n){l&&l.l(n)},m(n,s){l&&l.m(n,s),e=!0},p(n,s){l&&l.p&&(!e||s&8)&&A(l,t,n,n[3],e?E(t,n[3],s,null):M(n[3]),null)},i(n){e||(h(l,n),e=!0)},o(n){f(l,n),e=!1},d(n){l&&l.d(n)}}}function q(i){let e,t,l,n;const s=[U,L],o=[];function a(u,r){return u[0]?0:1}return e=a(i),t=o[e]=s[e](i),{c(){t.c(),l=S()},l(u){t.l(u),l=S()},m(u,r){o[e].m(u,r),g(u,l,r),n=!0},p(u,[r]){let c=e;e=a(u),e===c?o[e].p(u,r):(T(),f(o[c],1,1,()=>{o[c]=null}),D(),t=o[e],t?t.p(u,r):(t=o[e]=s[e](u),t.c()),h(t,1),t.m(l.parentNode,l))},i(u){n||(h(t),n=!0)},o(u){f(t),n=!1},d(u){o[e].d(u),u&&d(l)}}}function J(i,e,t){let{$$slots:l={},$$scope:n}=e,{href:s=null}=e,{disabled:o=!1}=e,{spin:a=!1}=e;function u(r){z.call(this,i,r)}return i.$$set=r=>{"href"in r&&t(0,s=r.href),"disabled"in r&&t(1,o=r.disabled),"spin"in r&&t(2,a=r.spin),"$$scope"in r&&t(3,n=r.$$scope)},[s,o,a,n,l,u]}class te extends j{constructor(e){super(),G(this,e,J,q,O,{href:0,disabled:1,spin:2})}}function K(i){let e,t;const l=i[1].default,n=C(l,i,i[0],null);return{c(){e=w("div"),n&&n.c(),this.h()},l(s){e=y(s,"DIV",{class:!0});var o=k(e);n&&n.l(o),o.forEach(d),this.h()},h(){m(e,"class","svelte-k0makj")},m(s,o){g(s,e,o),n&&n.m(e,null),t=!0},p(s,[o]){n&&n.p&&(!t||o&1)&&A(n,l,s,s[0],t?E(l,s[0],o,null):M(s[0]),null)},i(s){t||(h(n,s),t=!0)},o(s){f(n,s),t=!1},d(s){s&&d(e),n&&n.d(s)}}}function P(i,e,t){let{$$slots:l={},$$scope:n}=e;return i.$$set=s=>{"$$scope"in s&&t(0,n=s.$$scope)},[n,l]}class se extends j{constructor(e){super(),G(this,e,P,K,O,{})}}function R(i,e){if(i.empty)throw Error(`source-empty ${i.name}`);if(i.done)throw Error(`source-closed ${i.name}`);if(e.full)throw Error(`target-full ${i.name}`);const t=i.topColor;if(e.length>0&&t!==e.topColor)throw Error("invalid-color");const l=Math.min(i.topAmount,e.emptySpace),n=i.levels.slice(0,-l),s=Array(l).fill(t),o=[...e.levels,...s];return[new p(i.id,n),new p(e.id,o)]}class p{constructor(e,t=[]){this.id=e,this.levels=t}get name(){return String.fromCharCode(65+this.id)}get empty(){return this.levels.length===0}get full(){return this.levels.length>=4}get emptySpace(){return 4-this.levels.length}get done(){return this.levels.length===4&&this.levels[0]===this.levels[1]&&this.levels[1]===this.levels[2]&&this.levels[2]==this.levels[3]}get topColor(){return this.levels.length?this.levels[this.levels.length-1]:null}get topAmount(){if(this.levels.length<=1)return this.levels.length;const e=this.topColor;let t=1;for(;t<this.levels.length;){if(this.levels[this.levels.length-1-t]!=e)return t;t+=1}return this.levels.length}get singleColor(){return this.topAmount===this.levels.length}accepts(e){return this.empty?4:this.full?0:this.topColor===e?this.emptySpace:0}add(e){if(!this.full)return new p(this.id,[...this.levels,e])}}const V=19;class N{constructor(e,t){this.items=e,this.cumulative=[],this.tot=0;for(let l=0;l<e.length;l++)this.tot+=t[l],this.cumulative.push(this.tot)}randomItem(){const e=Math.random()*this.tot;for(let t=0;t<this.items.length;t++)if(this.cumulative[t]>e)return this.items[t];return this.items[this.items.length-1]}}function $(i){let e=[];for(let t=0;t<i.length;t++){const l=i[t];if(!l.done&&!l.empty)for(let n=0;n<i.length;n++){const s=i[n];t!==n&&s.accepts(l.topColor)&&e.push({from:l.id,to:s.id})}}return e}function Q(i){return i.map(e=>e.done||e.empty).reduce((e,t)=>e&&t,!0)}class _{constructor(e=[]){this.tubes=[];for(const[t,l]of e.entries())l instanceof p?this.tubes.push(l):this.tubes.push(new p(t,l));Q(this.tubes)?this.status="win":this.possibleActions().length===0&&(this.status="lose")}possibleActions(){return $(this.tubes)}get won(){return this.status==="win"}get lost(){return this.status==="lose"}get ended(){return this.status!==void 0}get numClosed(){return this.tubes.filter(e=>e.done).length}historyEntry({from:e,to:t}){if(this.tubes[e].topColor!==this.tubes[t].topColor&&!this.tubes[t].empty)throw new Error("invalid-color");const l=this.tubes[e].topColor;return{fromIndex:e,toIndex:t,fromId:this.tubes[e].name,toId:this.tubes[t].name,color:l,amount:Math.min(this.tubes[e].topAmount,this.tubes[t].accepts(l))}}applyMove({from:e,to:t}){const[l,n]=R(this.tubes[e],this.tubes[t]),s=[...this.tubes];return s[e]=l,s[t]=n,new _(s)}add(e,t){const l=[...this.tubes];return l[t]=this.tubes[t].add(e),new _(l)}getHash(){return this.tubes.map(e=>e.levels.concat(e.full?[]:[0])).flat().map(e=>e.toString(36)).join("")}}function v(i){return i[Math.floor(Math.random()*i.length)]}function X(i){for(let e=i.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[i[e],i[t]]=[i[t],i[e]]}}function Y(i){const e=Array(V).fill().map((t,l)=>l+1);return X(e),e.slice(0,i)}function Z(i){i=i||10+Math.floor(Math.random()*6);const e=Y(i-2),t=new Array(i-2).fill().map((s,o)=>new Array(4).fill(e[o])).concat([[],[]]),l=new _(t);for(let s=0;s<70;s++){console.debug(JSON.stringify(l.tubes));const o=new N(l.tubes,l.tubes.map(b=>b.topAmount)).randomItem(),a=l.tubes.filter(b=>!b.full&&b.id!==o.id),u=v(a),r=Math.min(o.singleColor?o.topAmount-1:o.topAmount,u.emptySpace),c=new N([1,2,3].splice(0,r),[1,3,9].splice(r)).randomItem();console.debug(`move ${s}: ${o.id} -> ${u.id}, ${c} blocks`);const W=o.levels.splice(-c);u.levels.push(...W)}let n=l.tubes.filter(s=>s.empty).length;for(let s=0;s<100&&n<2;s++){const o=l.tubes.filter(r=>!r.empty),a=v(o),u=l.tubes.filter(r=>!r.full&&r.levels.length>a.levels.length);if(u.length>0){const r=v(u);console.debug(`move: ${a.id} -> ${r.id}`);const c=a.levels.splice(-1);r.levels.push(...c)}n=l.tubes.filter(r=>r.empty).length}return new _(l.tubes)}const le=H(Z());export{se as B,_ as G,V as N,p as T,te as a,le as c,Z as r};
